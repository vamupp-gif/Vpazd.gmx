<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>spr_player_run</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// --- MOZGÁS VÁLTOZÓK ---
hsp = 0;
vsp = 0;
grv = 0.8;
walksp = 6;
jmp = -10;
was_on_ground = false;

// --- LÖVÉS ---
ammo = 10;
can_shoot = true;
shoot_cooldown = 10;

// --- UGRÁSOK ---
jump_count = 0;
max_jumps = 2;

// --- SLIDE ---
slide_speed = 10;
slide_time = 20;
slide_timer = 0;
is_sliding = false;
slide_released = true; // addig nem lehet újra slide, amíg le nyilat nem engeded

// --- KÚSZÁS ÉS GUGGOLÁS ---
creep_speed = 2;
is_creeping = false;
is_crouching = false;

// --- ÉLET ---
p_hp = 5;

if (!variable_global_exists("m_hp"))
    global.m_hp = 3;
if (!variable_global_exists("money"))
    global.money = 0;    
    
invincible = false;
invincible_timer = 0;

// --- GYORSABB ZUHANÁS (DOWN JUMP) ---
is_fastfall = false;

plat_offset = undefined;
 y_offset = undefined;
 
 ignore_platform_timer = 0;
 // Van-e kulcs
has_key = false;


</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>can_shoot = true;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// --- IRÁNYÍTÁS ---
key_left   = keyboard_check(vk_left);
key_right  = keyboard_check(vk_right);
key_jump   = keyboard_check_pressed(vk_space);
key_down   = keyboard_check(vk_down);

// --- TALAJELLENŐRZÉS ---
on_ground = place_meeting(x, y + 1, obj_solid) || place_meeting(x, y + 1, obj_moving_platform);


// ====================================================================
//                          GRAVITÁCIÓ
// ====================================================================
vsp += grv;

// --- FALRA UGRÁS / PLATFORMRA LESZÁLLÁS ellenőrzése
if (vsp &gt; 0) {
    if (place_meeting(x, y + vsp, obj_moving_wall)) {
        while (!place_meeting(x, y + 1, obj_moving_wall)) {
            y += 1;
        }
        vsp = 0;
        on_ground = true;
    }
}

// --- Y irány (talaj + mozgó platform)
var can_collide_platform = (ignore_platform_timer &lt;= 0);
var plat  = instance_place(x, y + vsp, obj_moving_platform);
var plat2 = noone;
if (can_collide_platform) {
    plat2 = instance_place(x, y + vsp, obj_moving_wall);
}

// ====================================================================
//                       ÜTKÖZÉSEK KEZELÉSE
// ====================================================================

// X irány (szilárd + platform)
var plat_side = instance_place(x + sign(hsp), y, obj_moving_platform);

if (place_meeting(x + hsp, y, obj_solid) || plat_side != noone) {
    while (!place_meeting(x + sign(hsp), y, obj_solid) &amp;&amp;
           instance_place(x + sign(hsp), y, obj_moving_platform) == noone) {
        x += sign(hsp);
    }
    hsp = 0;
}
x += hsp;

// ====================================================================
//                     Y irány (talaj + mozgó platform)
// ====================================================================

var plat = instance_place(x, y + vsp, obj_moving_platform);
var mwall = instance_place(x, y + vsp, obj_moving_wall);
var below = place_meeting(x, y + vsp, obj_solid) || plat != noone;

if (below) {
    // addig mozgatjuk a játékost, amíg közvetlenül fölötte lesz a talaj/platform tetejének
    while (
        !place_meeting(x, y + sign(vsp), obj_solid) &amp;&amp; 
        instance_place(x, y + sign(vsp), obj_moving_platform) == noone
    ) {
        y += sign(vsp);
    }
    vsp = 0;

    // --- Ha mozgó platformon áll ---
    if (plat != noone ) {
        // Ha most lépett rá
        if (plat_offset == undefined) {
            plat_offset = x - plat.x;
            y_offset = y - plat.y;
        }
        // var target_x;
        if (!key_left &amp;&amp; !key_right) {
            // Nem nyom irányt → követi a platform mozgását
            target_x = plat.x + plat_offset
            x = plat.x + plat_offset
            y = plat.y + y_offset;
       
         } else {
            // Mozog, ezért csak Y-t követi
            y = plat.y + y_offset;
            plat_offset = x - plat.x;
        }
        
        
    } else {
        // nincs platform alatt → töröljük az offsetet
        plat_offset = undefined;
        y_offset = undefined;
    }
    
}

y += vsp;


// ====================================================================
//                 SZORULÁS ELLENŐRZÉS / KISZABADÍTÁS
// ====================================================================

if (place_meeting(x, y, obj_solid)  ) {
    while (place_meeting(x, y, obj_solid) ) {
        y -= 1;
    }
    vsp = 0;
}
else if (place_meeting(x, y, obj_moving_platform)){
 while ( (place_meeting(x, y, obj_moving_platform) )){
  y += 1
}
vsp = 0;
}



// ====================================================================
//                         FÖLDRE ÉRÉS RESET
// ====================================================================
var plat = instance_place(x, y + vsp, obj_moving_platform);
if ((on_ground &amp;&amp; !was_on_ground) || (plat &amp;&amp; !was_on_ground)) {
    jump_count = 0;
    if(is_fastfall){
     //animation for big explosion !!!!BOOOMMM!!!!
     is_fastfall = false; // reseteljük a downjump flag-et
    }
}

// ====================================================================
//                         SLIDE (CSÚSZÁS)
// ====================================================================

if (on_ground &amp;&amp; !is_sliding &amp;&amp; !is_crouching &amp;&amp; !is_creeping &amp;&amp; abs(hsp) &gt; 0) {
    if (key_down &amp;&amp; slide_released) {
        is_sliding = true;
        slide_timer = slide_time;
        sprite_index = spr_player_slide;
        image_index = 0;
        image_speed = 1;

        if (image_xscale == 1) hsp = slide_speed;
        else hsp = -slide_speed;

        slide_released = false;
    }
}

if (is_sliding) {
    slide_timer -= 1;
    if (slide_timer &lt;= 0 || !on_ground) {
        is_sliding = false;
        hsp = 0;
    }
}

// --- GUGOLÁS / KÚSZÁS ---
// csak akkor engedélyezett, ha a slide_released igaz és nincs downjump után visszamaradt lenyomás
if (!is_sliding &amp;&amp; on_ground ){ //&amp;&amp; slide_released) {
    if (key_down &amp;&amp; !(key_left || key_right)) {
        // guggolás
        is_crouching = true;
        is_creeping = false;
        hsp = 0;
        sprite_index = spr_player_down;
        image_speed = 0.3;
    }
    else if (key_down &amp;&amp; (key_left || key_right)) {
        // kúszás
        is_crouching = false;
        is_creeping = true;
        hsp = (key_right - key_left) * creep_speed;
        sprite_index = spr_player_creep;
        image_speed = 0.4;
    }
    else {
        is_crouching = false;
        is_creeping = false;
    }
}


//---------------------------------------------
//-------------platform------------------------
//---------------------------------------------





// ha felengedte a le nyilat → újra engedélyezett a slide és crouch
if (!key_down) {
    slide_released = true;
}

// ====================================================================
//                         NORMÁL MOZGÁS
// ====================================================================

if (!is_sliding &amp;&amp; !is_crouching &amp;&amp; !is_creeping) {
    hsp = (key_right - key_left) * walksp;
}

// ====================================================================
//                         UGRÁSOK
// ====================================================================

if (key_jump &amp;&amp; jump_count &lt; max_jumps &amp;&amp; !is_sliding &amp;&amp; !is_crouching &amp;&amp; !is_creeping) {
    vsp = jmp;
    jump_count += 1;

    if (jump_count == 1) {
        sprite_index = spr_player_jump;
        image_index = 0;
        image_speed = 0.5;
        
        // Hang lejátszása
        audio_play_sound(snd_ugras1, 1, false);
        
    } else if (jump_count == 2) {
        sprite_index = spr_player_doublejump;
        image_index = 0;
        image_speed = 0.5;
        
        // Hang lejátszása
        audio_play_sound(snd_ugras2, 1, false);
        
    }
}

// ====================================================================
//                        DOWN-JUMP (GYORSABB ZUHANÁS)
// ====================================================================

if (!on_ground &amp;&amp; vsp &gt; 0) {
    if (key_down &amp;&amp; !is_fastfall) {
        // egyszeri gyorsítás és animáció
        is_fastfall = true;
        vsp += grv * 8;
        hsp = 0;
        sprite_index = spr_player_downjump;
        image_index = 0;
        image_speed = 0.5;

        slide_released = false; // ne engedje rögtön slide/crouch földet érés után
    }
} 

// ====================================================================
//                           ANIMÁCIÓK
// ====================================================================

if (!is_sliding &amp;&amp; !is_creeping &amp;&amp; !is_crouching &amp;&amp; !is_fastfall) {
    // irány
    if (hsp &gt; 0) image_xscale = 1;
    if (hsp &lt; 0) image_xscale = -1;

    // landolás
    if (on_ground &amp;&amp; !was_on_ground) {
        sprite_index = spr_player_land;
        image_index = 0;
        image_speed = 1;
    }
    // levegőben
    else if (!on_ground &amp;&amp; sprite_index != spr_player_downjump) {
        if (jump_count == 1 &amp;&amp; sprite_index != spr_player_jump) {
            sprite_index = spr_player_jump;
            image_index = 0;
            image_speed = 0.5;
        } else if (jump_count == 2 &amp;&amp; sprite_index != spr_player_doublejump) {
            sprite_index = spr_player_doublejump;
            image_index = 0;
            image_speed = 0.5;
        }
    }
    // futás
    else if (hsp != 0 &amp;&amp; sprite_index != spr_player_land) {
        sprite_index = spr_player_run;
        image_speed = 1;
    }
    // állás
    else if (sprite_index != spr_player_land) {
        sprite_index = spr_player_idle;
        image_speed = 0.4;
    }
}

// land animáció vége → vissza idle-be
if (sprite_index == spr_player_land &amp;&amp; image_index &gt;= image_number - 1) {
    sprite_index = spr_player_idle;
    image_speed = 0.4;
}

// ====================================================================
//                           SEBZŐDÉS / HP
// ====================================================================


 var enemy4 = instance_place(x, y, obj_demo_boss);
if (enemy4 != noone) {
 if (!invincible) {
        // --- NORMÁL ütközés ---  
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed * 3;
        if (enemy4.x &gt; x) hsp = -45; else hsp = 45;
        vsp = -25;
    }
}

  var enemy3 = instance_place(x, y, obj_enemy3);
if (enemy3 != noone) {
 if (!invincible) {
        // --- NORMÁL ütközés ---  
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed;
        if (enemy3.x &gt; x) hsp = -35; else hsp = 35;
        vsp = -15;
    }
}

if (invincible) {
    invincible_timer -= 1;
    if (invincible_timer &lt;= 0) invincible = false;
}


 var enemy2 = instance_place(x, y, obj_enemy2);
if (enemy2 != noone) {
 if (!invincible) {
        // --- NORMÁL ütközés ---  
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed;
        if (enemy2.x &gt; x) hsp = -8; else hsp = 8;
        vsp = -6;
    }
}

if (invincible) {
    invincible_timer -= 1;
    if (invincible_timer &lt;= 0) invincible = false;
}

 var spike = instance_place(x, y, obj_spike);
if (spike != noone) {
 if (!invincible) {
        // --- NORMÁL ütközés ---  
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed;
        if (spike.x &gt; x) hsp = -8; else hsp = 8;
        vsp = -6;
    }
}

if (invincible) {
    invincible_timer -= 1;
    if (invincible_timer &lt;= 0) invincible = false;
}



var enemy = instance_place(x, y, obj_enemy);
if (enemy != noone) {
    if (is_sliding) {
        // --- SLIDE ütközés ---  
     var push_dir;
    if (image_xscale == 1) {
        push_dir = 1;
    } else {
        push_dir = -1;
    }
    enemy.hsp = push_dir * 10;  // oldalirány
    enemy.vsp = -6;            // felfelé pattintás
    enemy.is_knocked = true;
    enemy.knock_timer = 20;  // 20 frame-ig „ütve” 
        
    // player nem sérül, nem lökődik
    }
    else if (is_fastfall) {
        // --- DOWNJUMP ütközés ---  
        enemy.hp -= 0.0001;            // enemy sebződik
         
        
        var push_dir;
        if (image_xscale == 1) {
            push_dir = 1;
        } else {
            push_dir = -1;
        }
        enemy.hsp = push_dir * 10;  // oldalirány
        enemy.vsp = -8;            // felfelé
  
        enemy.is_knocked = true;
        enemy.knock_timer = 20;  // 20 frame-ig „ütve”        
                      
                    // player nem sérül, nem lökődik
    }
    else if (!invincible) {
        // --- NORMÁL ütközés ---  
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed;
        if (enemy.x &gt; x) hsp = -8; else hsp = 8;
        vsp = -6;
    }
}

if (invincible) {
    invincible_timer -= 1;
    if (invincible_timer &lt;= 0) invincible = false;
}

// ====================================================================
//                           PORHATÁS LANDOLÁSNÁL
// ====================================================================

// ha most ért földet
if (!was_on_ground &amp;&amp; on_ground) {
    var impact_speed = abs(vsp_previous); // előző frame-ből vesszük az esés sebességét
    if (impact_speed &gt; 4) { // csak ha tényleg gyorsan esett
        var dust = instance_create(x, y + sprite_height / 2, obj_dust);
        dust.image_xscale = image_xscale;
        dust.image_yscale = clamp(impact_speed / 10, 1, 2);
    }
}

//élet

if (p_hp &lt;= 0 || y &gt; room_height + 200)
{
    global.m_hp -= 1;

    if (global.m_hp &lt;= 0) {
        room_goto(rm_EndGame);
    } else {
        room_restart();
    }
}




// ====================================================================
//                            LÖVÉS
// ====================================================================

if (keyboard_check_pressed(vk_control) &amp;&amp; ammo &gt; 0 &amp;&amp; can_shoot) {
    var bullet = instance_create(x, y, obj_bullet);

    // --- FERDE IRÁNYOK ELŐSZÖR ---
    if (keyboard_check(vk_up) &amp;&amp; keyboard_check(vk_left)) {
        bullet.direction = 135; // balra-felfelé
    }
    else if (keyboard_check(vk_up) &amp;&amp; keyboard_check(vk_right)) {
        bullet.direction = 45; // jobbra-felfelé
    }
    // --- CSAK FELFELÉ ---
    else if (keyboard_check(vk_up)) {
        bullet.direction = 90;
    }
    
    // --- CSAK BALRA / JOBBRA ---
    else {
        if (image_xscale == 1) bullet.direction = 0;   // jobbra
        else bullet.direction = 180;                   // balra
    }

    bullet.speed = 25;
    ammo -= 1;
    can_shoot = false;
    alarm[0] = shoot_cooldown;
}


// ====================================================================
//                      ÁLLAPOT MENTÉSE
// ====================================================================
// --- PLATFORM FELMÁSZÁS / ALÁBÚJÁS ---

var plat_up   = instance_place(x, y - 1, obj_moving_wall);
var plat_down = instance_place(x, y + 1, obj_moving_wall);

// ha alatta van a platform és felfele nyilat nyom → felmegy rá
if (keyboard_check_pressed(vk_up) || keyboard_check(vk_up)) {
  // keressük a fal‑platformot fölöttünk
    var wall_inst = instance_place(x, y - sprite_height, obj_moving_wall);

    if (wall_inst != noone) {
        // Áthelyezés a fal tetejére
        sprite_index = spr_player_jump;
        image_index = 0;
        image_speed = 0.5;
        y = wall_inst.bbox_top - sprite_height/2;
        vsp = 0;
    } else {
        show_debug_message("Nem található elérhető platform fölöttem");
    }
}


// ha rajta van és lefelé nyilat nyom → átesik rajta
if (keyboard_check_pressed(vk_down)|| keyboard_check(vk_down)) {
    if (place_meeting(x, y + 1, obj_moving_wall)) {
        y += (sprite_height); // egy kicsit beljebb
        ignore_platform_timer = 15; // 15 frame-ig ne érzékelje az ütközést
    }
}

// Ha épp most engedtük el a "le" nyilat → újra érzékelhet platformot
if (ignore_platform_timer &gt; 0) {
    ignore_platform_timer -= 1;
}


vsp_previous = vsp;
was_on_ground = on_ground;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Ellenőrizzük, hogy ütközött-e az obj_erme objektummal
if (place_meeting(x, y, obj_erme)) {
    
    // Megtaláljuk a konkrét érmét, hogy törölhessük
    var erme = instance_place(x, y, obj_erme);

    if (erme != noone) {
        // Hang lejátszása
       // audio_play_sound(snd_erme, 1, false);

        // Pénz hozzáadása
        global.money += 10;

        // Érme törlése
        with (erme) instance_destroy();
    }
}


// Ellenőrizzük, hogy ütközött-e az obj_erme objektummal
if (place_meeting(x, y, obj_elet)) {
    
    // Megtaláljuk a konkrét érmét, hogy törölhessük
    var erme = instance_place(x, y, obj_elet);

    if (erme != noone) {
        // Hang lejátszása
       // audio_play_sound(snd_erme, 1, false);

        if (obj_player.p_hp &lt; 5){// Pénz hozzáadása
        obj_player.p_hp += 1;
        }

        // Érme törlése
        with (erme) instance_destroy();
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Kulcs felvétele
var k = instance_place(x, y, obj_key);
if (k != noone) {
    has_key = true;        // player most már rendelkezik kulccsal
    with (k) instance_destroy(); // töröljük a kulcsot
}


// Ha van kulcs és hozzáér az ajtóhoz
if (has_key) {
    var d = instance_place(x, y, obj_door);
    if (d != noone) {
        with (d) instance_destroy(); // ajtó eltűnik
        has_key = false;             // kulcs elhasználódott
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// --- Villogás sebezhetetlenség alatt ---
if (invincible) {
    if (floor(current_time / 100) mod 2 == 0) {
        draw_self();
    }
} else {
    draw_self();
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
