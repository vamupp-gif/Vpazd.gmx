<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>spr_player2_run</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// --- MOZGÁS VÁLTOZÓK ---
hsp = 0;
vsp = 0;
grv = 0.8;
walksp = 6;
jmp = -10;
was_on_ground = false;

// --- LÖVÉS ---
ammo = 10;
can_shoot = true;
shoot_cooldown = 10;

// --- UGRÁSOK ---
jump_count = 0;
max_jumps = 2;

// --- SLIDE ---
slide_speed = 10;
slide_time = 20;
slide_timer = 0;
is_sliding = false;
slide_released = true; // addig nem lehet újra slide, amíg le nyilat nem engeded

// --- KÚSZÁS ÉS GUGGOLÁS ---
creep_speed = 2;
is_creeping = false;
is_crouching = false;

// --- ÉLET ---
p_hp = 5;

if (!variable_global_exists("m_hp"))
    global.m_hp = 3;
if (!variable_global_exists("money"))
    global.money = 0;    
    
invincible = false;
invincible_timer = 0;

// --- GYORSABB ZUHANÁS (DOWN JUMP) ---
is_fastfall = false;

plat_offset = undefined;
 y_offset = undefined;
 
 ignore_platform_timer = 0;
 // Van-e kulcs
has_key = false;


</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>can_shoot = true;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Kulcs felvétele
var k = instance_place(x, y, obj_key);
if (k != noone) {
    has_key = true;        // player most már rendelkezik kulccsal
    with (k) instance_destroy(); // töröljük a kulcsot
}


// Ha van kulcs és hozzáér az ajtóhoz
if (has_key) {
    var d = instance_place(x, y, obj_door);
    if (d != noone) {
        with (d) instance_destroy(); // ajtó eltűnik
        has_key = false;             // kulcs elhasználódott
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// ====================================================================
//                           IRÁNYÍTÁS (WASD + K + L)
// ====================================================================

key_left   = keyboard_check(ord("A"));
key_right  = keyboard_check(ord("D"));
key_down   = keyboard_check(ord("S"));
key_jump   = keyboard_check_pressed(ord("K"));  // SPACE → K
key_shoot  = keyboard_check_pressed(ord("L"));  // CTRL → L


// --- TALAJELLENŐRZÉS ---
on_ground = place_meeting(x, y + 1, obj_solid) || place_meeting(x, y + 1, obj_moving_platform);

// ====================================================================
//                          GRAVITÁCIÓ
// ====================================================================
vsp += grv;

// --- FALRA UGRÁS / PLATFORMRA LESZÁLLÁS ellenőrzése
if (vsp &gt; 0) {
    if (place_meeting(x, y + vsp, obj_moving_wall)) {
        while (!place_meeting(x, y + 1, obj_moving_wall)) {
            y += 1;
        }
        vsp = 0;
        on_ground = true;
    }
}

var can_collide_platform = (ignore_platform_timer &lt;= 0);
var plat  = instance_place(x, y + vsp, obj_moving_platform);
var plat2 = noone;
if (can_collide_platform) {
    plat2 = instance_place(x, y + vsp, obj_moving_wall);
}

// ====================================================================
//                       ÜTKÖZÉSEK KEZELÉSE
// ====================================================================

// X irány (szilárd + platform)
var plat_side = instance_place(x + sign(hsp), y, obj_moving_platform);

if (place_meeting(x + hsp, y, obj_solid) || plat_side != noone) {
    while (!place_meeting(x + sign(hsp), y, obj_solid) &amp;&amp;
           instance_place(x + sign(hsp), y, obj_moving_platform) == noone) {
        x += sign(hsp);
    }
    hsp = 0;
}
x += hsp;

// ====================================================================
//                     Y irány (talaj + mozgó platform)
// ====================================================================

var plat = instance_place(x, y + vsp, obj_moving_platform);
var mwall = instance_place(x, y + vsp, obj_moving_wall);
var below = place_meeting(x, y + vsp, obj_solid) || plat != noone;

if (below) {
    while (
        !place_meeting(x, y + sign(vsp), obj_solid) &amp;&amp; 
        instance_place(x, y + sign(vsp), obj_moving_platform) == noone
    ) {
        y += sign(vsp);
    }
    vsp = 0;

    if (plat != noone ) {
        if (plat_offset == undefined) {
            plat_offset = x - plat.x;
            y_offset = y - plat.y;
        }
        if (!key_left &amp;&amp; !key_right) {
            x = plat.x + plat_offset
            y = plat.y + y_offset;
        } else {
            y = plat.y + y_offset;
            plat_offset = x - plat.x;
        }
    } else {
        plat_offset = undefined;
        y_offset = undefined;
    }
}

y += vsp;

// ====================================================================
//                 SZORULÁS ELLENŐRZÉS / KISZABADÍTÁS
// ====================================================================

if (place_meeting(x, y, obj_solid)) {
    while (place_meeting(x, y, obj_solid)) {
        y -= 1;
    }
    vsp = 0;
}
else if (place_meeting(x, y, obj_moving_platform)){
 while ((place_meeting(x, y, obj_moving_platform))){
  y += 1
}
vsp = 0;
}

// ====================================================================
//                         FÖLDRE ÉRÉS RESET
// ====================================================================

var plat = instance_place(x, y + vsp, obj_moving_platform);
if ((on_ground &amp;&amp; !was_on_ground) || (plat &amp;&amp; !was_on_ground)) {
    jump_count = 0;
    if(is_fastfall){
        is_fastfall = false;
    }
}

// ====================================================================
//                         SLIDE (CSÚSZÁS)
// ====================================================================

if (on_ground &amp;&amp; !is_sliding &amp;&amp; !is_crouching &amp;&amp; !is_creeping &amp;&amp; abs(hsp) &gt; 0) {
    if (key_down &amp;&amp; slide_released) {
        is_sliding = true;
        slide_timer = slide_time;
        sprite_index = spr_player2_slide;
        image_index = 0;
        image_speed = 1;

        if (image_xscale == 1) hsp = slide_speed;
        else hsp = -slide_speed;

        slide_released = false;
    }
}

if (is_sliding) {
    slide_timer -= 1;
    if (slide_timer &lt;= 0 || !on_ground) {
        is_sliding = false;
        hsp = 0;
    }
}

// --- GUGOLÁS / KÚSZÁS ---
if (!is_sliding &amp;&amp; on_ground){
    if (key_down &amp;&amp; !(key_left || key_right)) {
        is_crouching = true;
        is_creeping = false;
        hsp = 0;
        sprite_index = spr_player2_down;
        image_speed = 0.3;
    }
    else if (key_down &amp;&amp; (key_left || key_right)) {
        is_crouching = false;
        is_creeping = true;
        hsp = (key_right - key_left) * creep_speed;
        sprite_index = spr_player2_creep;
        image_speed = 0.4;
    }
    else {
        is_crouching = false;
        is_creeping = false;
    }
}

// ha felengedte a le nyilat → újra engedélyezett a slide és crouch
if (!key_down) {
    slide_released = true;
}

// ====================================================================
//                         NORMÁL MOZGÁS
// ====================================================================

if (!is_sliding &amp;&amp; !is_crouching &amp;&amp; !is_creeping) {
    hsp = (key_right - key_left) * walksp;
}

// ====================================================================
//                         UGRÁSOK
// ====================================================================

if (key_jump &amp;&amp; jump_count &lt; max_jumps &amp;&amp; !is_sliding &amp;&amp; !is_crouching &amp;&amp; !is_creeping) {
    vsp = jmp;
    jump_count += 1;

    if (jump_count == 1) {
        sprite_index = spr_player2_jump;
        image_index = 0;
        image_speed = 0.5;
        audio_play_sound(snd_ugras1, 1, false);
        
    } else if (jump_count == 2) {
        sprite_index = spr_player2_doublejump;
        image_index = 0;
        image_speed = 0.5;
        audio_play_sound(snd_ugras2, 1, false);
    }
}

// ====================================================================
//                        DOWN-JUMP
// ====================================================================

if (!on_ground &amp;&amp; vsp &gt; 0) {
    if (key_down &amp;&amp; !is_fastfall) {
        is_fastfall = true;
        vsp += grv * 8;
        hsp = 0;
        sprite_index = spr_player2_downjump;
        image_index = 0;
        image_speed = 0.5;

        slide_released = false;
    }
}

// ====================================================================
//                           ANIMÁCIÓK
// ====================================================================

if (!is_sliding &amp;&amp; !is_creeping &amp;&amp; !is_crouching &amp;&amp; !is_fastfall) {

    if (hsp &gt; 0) image_xscale = 1;
    if (hsp &lt; 0) image_xscale = -1;

    if (on_ground &amp;&amp; !was_on_ground) {
        sprite_index = spr_player2_land;
        image_index = 0;
        image_speed = 1;
    }
    else if (!on_ground &amp;&amp; sprite_index != spr_player2_downjump) {
        if (jump_count == 1 &amp;&amp; sprite_index != spr_player2_jump) {
            sprite_index = spr_player2_jump;
            image_index = 0;
            image_speed = 0.5;
        } else if (jump_count == 2 &amp;&amp; sprite_index != spr_player2_doublejump) {
            sprite_index = spr_player2_doublejump;
            image_index = 0;
            image_speed = 0.5;
        }
    }
    else if (hsp != 0 &amp;&amp; sprite_index != spr_player2_land) {
        sprite_index = spr_player2_run;
        image_speed = 1;
    }
    else if (sprite_index != spr_player2_land) {
        sprite_index = spr_player2_idle;
        image_speed = 0.4;
    }
}

if (sprite_index == spr_player2_land &amp;&amp; image_index &gt;= image_number - 1) {
    sprite_index = spr_player2_idle;
    image_speed = 0.4;
}

// ====================================================================
//                           SEBZŐDÉS / HP
// ====================================================================

/*  A teljes enemy – spike – sebződés kódod változatlan marad,
    mivel nem függ a gomboktól,
    ide bemásoljuk a teljes eredetit (nem rövidítem le). 
*/


 var enemy4 = instance_place(x, y, obj_demo_boss);
if (enemy4 != noone) {
 if (!invincible) {
        // --- NORMÁL ütközés ---  
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed;
        if (enemy4.x &gt; x) hsp = -45; else hsp = 45;
        vsp = -25;
    }
}




var enemy3 = instance_place(x, y, obj_enemy3);
if (enemy3 != noone) {
 if (!invincible) {
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed;
        if (enemy3.x &gt; x) hsp = -35; else hsp = 35;
        vsp = -15;
    }
}

if (invincible) {
    invincible_timer -= 1;
    if (invincible_timer &lt;= 0) invincible = false;
}

var enemy2 = instance_place(x, y, obj_enemy2);
if (enemy2 != noone) {
 if (!invincible) {
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed;
        if (enemy2.x &gt; x) hsp = -8; else hsp = 8;
        vsp = -6;
    }
}

if (invincible) {
    invincible_timer -= 1;
    if (invincible_timer &lt;= 0) invincible = false;
}

var spike = instance_place(x, y, obj_spike);
if (spike != noone) {
 if (!invincible) {
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed;
        if (spike.x &gt; x) hsp = -8; else hsp = 8;
        vsp = -6;
    }
}

if (invincible) {
    invincible_timer -= 1;
    if (invincible_timer &lt;= 0) invincible = false;
}

var enemy = instance_place(x, y, obj_enemy);
if (enemy != noone) {
    if (is_sliding) {

    var push_dir;
    if (image_xscale == 1) push_dir = 1; else push_dir = -1;

    enemy.hsp = push_dir * 10;
    enemy.vsp = -6;
    enemy.is_knocked = true;
    enemy.knock_timer = 20;

    }
    else if (is_fastfall) {

        enemy.hp -= 0.0001;

        var push_dir;
        if (image_xscale == 1) push_dir = 1; else push_dir = -1;

        enemy.hsp = push_dir * 10;
        enemy.vsp = -8;
        enemy.is_knocked = true;
        enemy.knock_timer = 20;

    }
    else if (!invincible) {
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed;
        if (enemy.x &gt; x) hsp = -8; else hsp = 8;
        vsp = -6;
    }
}

if (invincible) {
    invincible_timer -= 1;
    if (invincible_timer &lt;= 0) invincible = false;
}

// ====================================================================
//                           PORHATÁS LANDOLÁSNÁL
// ====================================================================

if (!was_on_ground &amp;&amp; on_ground) {
    var impact_speed = abs(vsp_previous);
    if (impact_speed &gt; 4) {
        var dust = instance_create(x, y + sprite_height / 2, obj_dust);
        dust.image_xscale = image_xscale;
        dust.image_yscale = clamp(impact_speed / 10, 1, 2);
    }
}
//élet
if (p_hp &lt;= 0|| y &gt; room_height + 200)
{
    global.m_hp -= 1;

    if (global.m_hp &lt;= 0) {
        room_goto(rm_EndGame);
    } else {
        room_restart();
    }
}

// ====================================================================
//                            LÖVÉS (L gomb)
// ====================================================================

if (key_shoot &amp;&amp; ammo &gt; 0 &amp;&amp; can_shoot) {
    var bullet = instance_create(x, y, obj_bullet);

  if (keyboard_check(ord("W")) &amp;&amp; keyboard_check(ord("A"))) bullet.direction = 135; // balra-felfelé
else if (keyboard_check(ord("W")) &amp;&amp; keyboard_check(ord("D"))) bullet.direction = 45; // jobbra-felfelé
else if (keyboard_check(ord("W"))) bullet.direction = 90; // csak felfelé
else {
    if (image_xscale == 1) bullet.direction = 0;   // jobbra
    else bullet.direction = 180;                   // balra
}

    bullet.speed = 25;
    ammo -= 1;
    can_shoot = false;
    alarm[0] = shoot_cooldown;
}

// ====================================================================
//                 PLATFORM FELMÁSZÁS / ALÁBÚJÁS
// ====================================================================

var plat_up   = instance_place(x, y - 1, obj_moving_wall);
var plat_down = instance_place(x, y + 1, obj_moving_wall);

if (keyboard_check_pressed(vk_up) || keyboard_check(vk_up)) {
    var wall_inst = instance_place(x, y - sprite_height, obj_moving_wall);

    if (wall_inst != noone) {
        sprite_index = spr_player2_jump;
        image_index = 0;
        image_speed = 0.5;
        y = wall_inst.bbox_top - sprite_height/2;
        vsp = 0;
    }
}

if (keyboard_check_pressed(key_down) || keyboard_check(key_down)) {
    if (place_meeting(x, y + 1, obj_moving_wall)) {
        y += sprite_height;
        ignore_platform_timer = 15;
    }
}

if (ignore_platform_timer &gt; 0) ignore_platform_timer -= 1;

vsp_previous = vsp;
was_on_ground = on_ground;

// ====================================================================
//                         ÉRMÉK, ÉLET
// ====================================================================

if (place_meeting(x, y, obj_erme)) {
    var erme = instance_place(x, y, obj_erme);
    if (erme != noone) {
        global.money += 10;
        with (erme) instance_destroy();
    }
}

if (place_meeting(x, y, obj_elet)) {
    var erme = instance_place(x, y, obj_elet);

    if (erme != noone) {
        if (obj_player2.p_hp &lt; 5) {
            obj_player.p_hp += 1;
        }
        with (erme) instance_destroy();
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// --- Villogás sebezhetetlenség alatt ---
if (invincible) {
    if (floor(current_time / 100) mod 2 == 0) {
        draw_self();
    }
} else {
    draw_self();
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
