<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// --- IRÁNYÍTÁS ---
key_left   = keyboard_check(vk_left);
key_right  = keyboard_check(vk_right);
key_jump   = keyboard_check_pressed(vk_space);
key_down   = keyboard_check(vk_down);

// --- TALAJELLENŐRZÉS ---
var on_ground = place_meeting(x, y + 1, obj_solid);

// --- GRAVITÁCIÓ ---
vsp += grv;

// ====================================================================
//                       ÜTKÖZÉSEK KEZELÉSE
// ====================================================================

// X irány
if (place_meeting(x + hsp, y, obj_solid)) {
    while (!place_meeting(x + sign(hsp), y, obj_solid)) {
        x += sign(hsp);
    }
    hsp = 0;
}
x += hsp;

// Y irány
if (place_meeting(x, y + vsp, obj_solid)) {
    while (!place_meeting(x, y + sign(vsp), obj_solid)) {
        y += sign(vsp);
    }
    vsp = 0;
}
y += vsp;

// ====================================================================
//                         FÖLDRE ÉRÉS RESET
// ====================================================================

if (on_ground &amp;&amp; !was_on_ground) {
    jump_count = 0;
    is_fastfall = false; // reseteljük a downjump flag-et
}

// ====================================================================
//                         SLIDE (CSÚSZÁS)
// ====================================================================

if (on_ground &amp;&amp; !is_sliding &amp;&amp; !is_crouching &amp;&amp; !is_creeping &amp;&amp; abs(hsp) &gt; 0) {
    if (key_down &amp;&amp; slide_released) {
        is_sliding = true;
        slide_timer = slide_time;
        sprite_index = spr_player_slide;
        image_index = 0;
        image_speed = 1;

        if (image_xscale == 1) hsp = slide_speed;
        else hsp = -slide_speed;

        slide_released = false;
    }
}

if (is_sliding) {
    slide_timer -= 1;
    if (slide_timer &lt;= 0 || !on_ground) {
        is_sliding = false;
        hsp = 0;
    }
}

// --- GUGOLÁS / KÚSZÁS ---
// csak akkor engedélyezett, ha a slide_released igaz és nincs downjump után visszamaradt lenyomás
if (!is_sliding &amp;&amp; on_ground &amp;&amp; slide_released) {
    if (key_down &amp;&amp; !(key_left || key_right)) {
        // guggolás
        is_crouching = true;
        is_creeping = false;
        hsp = 0;
        sprite_index = spr_player_down;
        image_speed = 0.3;
    }
    else if (key_down &amp;&amp; (key_left || key_right)) {
        // kúszás
        is_crouching = false;
        is_creeping = true;
        hsp = (key_right - key_left) * creep_speed;
        sprite_index = spr_player_creep;
        image_speed = 0.4;
    }
    else {
        is_crouching = false;
        is_creeping = false;
    }
}

// ha felengedte a le nyilat → újra engedélyezett a slide és crouch
if (!key_down) {
    slide_released = true;
}

// ====================================================================
//                         NORMÁL MOZGÁS
// ====================================================================

if (!is_sliding &amp;&amp; !is_crouching &amp;&amp; !is_creeping) {
    hsp = (key_right - key_left) * walksp;
}

// ====================================================================
//                         UGRÁSOK
// ====================================================================

if (key_jump &amp;&amp; jump_count &lt; max_jumps &amp;&amp; !is_sliding &amp;&amp; !is_crouching &amp;&amp; !is_creeping) {
    vsp = jmp;
    jump_count += 1;

    if (jump_count == 1) {
        sprite_index = spr_player_jump;
        image_index = 0;
        image_speed = 0.5;
    } else if (jump_count == 2) {
        sprite_index = spr_player_doublejump;
        image_index = 0;
        image_speed = 0.5;
    }
}

// ====================================================================
//                        DOWN-JUMP (GYORSABB ZUHANÁS)
// ====================================================================

if (!on_ground &amp;&amp; vsp &gt; 0) {
    if (key_down &amp;&amp; !is_fastfall) {
        // egyszeri gyorsítás és animáció
        is_fastfall = true;
        vsp += grv * 8;
        hsp = 0;
        sprite_index = spr_player_downjump;
        image_index = 0;
        image_speed = 0.5;

        slide_released = false; // ne engedje rögtön slide/crouch földet érés után
    }
} 

// ====================================================================
//                           ANIMÁCIÓK
// ====================================================================

if (!is_sliding &amp;&amp; !is_creeping &amp;&amp; !is_crouching &amp;&amp; !is_fastfall) {
    // irány
    if (hsp &gt; 0) image_xscale = 1;
    if (hsp &lt; 0) image_xscale = -1;

    // landolás
    if (on_ground &amp;&amp; !was_on_ground) {
        sprite_index = spr_player_land;
        image_index = 0;
        image_speed = 1;
    }
    // levegőben
    else if (!on_ground &amp;&amp; sprite_index != spr_player_downjump) {
        if (jump_count == 1 &amp;&amp; sprite_index != spr_player_jump) {
            sprite_index = spr_player_jump;
            image_index = 0;
            image_speed = 0.5;
        } else if (jump_count == 2 &amp;&amp; sprite_index != spr_player_doublejump) {
            sprite_index = spr_player_doublejump;
            image_index = 0;
            image_speed = 0.5;
        }
    }
    // futás
    else if (hsp != 0 &amp;&amp; sprite_index != spr_player_land) {
        sprite_index = spr_player_run;
        image_speed = 1;
    }
    // állás
    else if (sprite_index != spr_player_land) {
        sprite_index = spr_player_idle;
        image_speed = 0.4;
    }
}

// land animáció vége → vissza idle-be
if (sprite_index == spr_player_land &amp;&amp; image_index &gt;= image_number - 1) {
    sprite_index = spr_player_idle;
    image_speed = 0.4;
}

// ====================================================================
//                           SEBZŐDÉS / HP
// ====================================================================

if (!invincible &amp;&amp; place_meeting(x, y, obj_enemy)) {
    p_hp -= 10;
    invincible = true;
    invincible_timer = room_speed;

    var enemy = instance_place(x, y, obj_enemy);
    if (enemy != noone) {
        if (enemy.x &gt; x) hsp = -8; else hsp = 8;
        vsp = -6;
    }
}

if (invincible) {
    invincible_timer -= 1;
    if (invincible_timer &lt;= 0) invincible = false;
}

// ====================================================================
//                           PORHATÁS LANDOLÁSNÁL
// ====================================================================

// ha most ért földet
if (!was_on_ground &amp;&amp; on_ground) {
    var impact_speed = abs(vsp_previous); // előző frame-ből vesszük az esés sebességét
    if (impact_speed &gt; 6) { // csak ha tényleg gyorsan esett
        var dust = instance_create(x, y + sprite_height / 2, obj_dust);
        dust.image_xscale = image_xscale;
        dust.image_yscale = clamp(impact_speed / 10, 1, 2);
    }
}

// ====================================================================
//                            LÖVÉS
// ====================================================================

if (keyboard_check_pressed(vk_control) &amp;&amp; ammo &gt; 0 &amp;&amp; can_shoot) {
    var bullet = instance_create(x, y, obj_bullet);

    if (image_xscale == 1) bullet.direction = 0;
    else bullet.direction = 180;

    bullet.speed = 8;
    ammo -= 1;
    can_shoot = false;
    alarm[0] = shoot_cooldown;
}

// ====================================================================
//                      ÁLLAPOT MENTÉSE
// ====================================================================
vsp_previous = vsp;
was_on_ground = on_ground;
























///enemy step
// --- GRAVITÁCIÓ ---
vsp += grv;
var on_ground = place_meeting(x, y + 1, obj_solid);

// --- JÁTÉKOS KERESÉSE ---
var target = instance_nearest(x, y, obj_player);
var sees_player = false;

if (target != noone) {
    var dist = point_distance(x, y, target.x, target.y);
    
    // Ha elég közel van
    if (dist &lt; target_distance) {
        // Ellenőrizzük, hogy nincs-e fal közte és a játékos között
        if (!collision_line(x, y, target.x, target.y, obj_solid, false, true)) {
            sees_player = true;
        }
    }
}

// --- ÁLLAPOTVÁLTÁS ---
if (sees_player) state = "chase";
else state = "wander";

// --- WANDER (véletlenszerű mozgás) ---
if (state == "wander") {
    wander_timer -= 1;
    jump_timer -= 1;
    
    // Időnként irányt vált
    if (wander_timer &lt;= 0) {
        wander_timer = irandom_range(60, 180);
        wander_dir = choose(-1, 1, 0); // néha meg is állhat
    }
    
    hsp = wander_dir * walksp;
    
    // Véletlen ugrás
    if (jump_timer &lt;= 0 &amp;&amp; on_ground) {
        vsp = jmp;
        jump_timer = irandom_range(60, 150);
    }
}

// --- CHASE (üldözés) ---
if (state == "chase" &amp;&amp; target != noone) {
    // Futás a játékos felé
  if (x &lt; target.x) {
    hsp = walksp * 1.5;
} else {
    hsp = -walksp * 1.5;
}

    // Véletlen ugrás közben is
    jump_timer -= 1;
    if (jump_timer &lt;= 0 &amp;&amp; on_ground) {
        vsp = jmp;
        jump_timer = irandom_range(60, 120);
    }
}

// --- ÜTKÖZÉSEK ---
if (place_meeting(x + hsp, y, obj_solid)) {
    while (!place_meeting(x + sign(hsp), y, obj_solid)) x += sign(hsp);
    hsp = 0;
}
x += hsp;

if (place_meeting(x, y + vsp, obj_solid)) {
    while (!place_meeting(x, y + sign(vsp), obj_solid)) y += sign(vsp);
    vsp = 0;
}
y += vsp;

// --- ANIMÁCIÓK ---
if (!on_ground) {
    sprite_index = spr_enemy_jump;
    image_speed = 0.4;
}
else if (hsp != 0) {
    sprite_index = spr_enemy_run;
    image_speed = 0.4;
}
else {
    sprite_index = spr_enemy_idle;
    image_speed = 0.4;
}

// --- IRÁNY FORDÍTÁS ---
if (hsp &gt; 0) image_xscale = 1;
if (hsp &lt; 0) image_xscale = -1;

// --- ÁLLAPOT FRISSÍTÉS ---
was_on_ground = on_ground;



if (hp &lt;= 0) {
            // halál animáció vagy eltűnés
            instance_destroy();
        }
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="obj_player">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// --- IRÁNYÍTÁS ---
key_left   = keyboard_check(vk_left);
key_right  = keyboard_check(vk_right);
key_jump   = keyboard_check_pressed(vk_space);
key_down   = keyboard_check(vk_down);

// --- TALAJELLENŐRZÉS ---
var on_ground = place_meeting(x, y + 1, obj_solid) || 
                (place_meeting(x, y + 1, obj_platform_passable) &amp;&amp; vsp &gt;= 0 &amp;&amp; (y + sprite_height/2) &lt; obj_platform_passable.y);


// --- GRAVITÁCIÓ ---
vsp += grv;

// ====================================================================
//                       ÜTKÖZÉSEK KEZELÉSE
// ====================================================================

// X irány
if (place_meeting(x + hsp, y, obj_solid)) {
    while (!place_meeting(x + sign(hsp), y, obj_solid)) {
        x += sign(hsp);
    }
    hsp = 0;
}
x += hsp;

// Y irány
if (place_meeting(x, y + vsp, obj_solid) || 
    (place_meeting(x, y + vsp, obj_platform_passable) &amp;&amp; vsp &gt;= 0 &amp;&amp; (y + sprite_height/2) &lt; obj_platform_passable.y)) 
{
    while (!place_meeting(x, y + sign(vsp), obj_solid) &amp;&amp;
           !(place_meeting(x, y + sign(vsp), obj_platform_passable) &amp;&amp; vsp &gt;= 0 &amp;&amp; (y + sprite_height/2) &lt; obj_platform_passable.y))
    {
        y += sign(vsp);
    }
    vsp = 0;
}
y += vsp;

// ====================================================================
//                         FÖLDRE ÉRÉS RESET
// ====================================================================

if (on_ground &amp;&amp; !was_on_ground) {
    jump_count = 0;
    if(is_fastfall){
     //animation for big explosion !!!!BOOOMMM!!!!
     is_fastfall = false; // reseteljük a downjump flag-et
    }
}

// ====================================================================
//                         SLIDE (CSÚSZÁS)
// ====================================================================

if (on_ground &amp;&amp; !is_sliding &amp;&amp; !is_crouching &amp;&amp; !is_creeping &amp;&amp; abs(hsp) &gt; 0) {
    if (key_down &amp;&amp; slide_released) {
        is_sliding = true;
        slide_timer = slide_time;
        sprite_index = spr_player_slide;
        image_index = 0;
        image_speed = 1;

        if (image_xscale == 1) hsp = slide_speed;
        else hsp = -slide_speed;

        slide_released = false;
    }
}

if (is_sliding) {
    slide_timer -= 1;
    if (slide_timer &lt;= 0 || !on_ground) {
        is_sliding = false;
        hsp = 0;
    }
}

// --- GUGOLÁS / KÚSZÁS ---
// csak akkor engedélyezett, ha a slide_released igaz és nincs downjump után visszamaradt lenyomás
if (!is_sliding &amp;&amp; on_ground ){ //&amp;&amp; slide_released) {
    if (key_down &amp;&amp; !(key_left || key_right)) {
        // guggolás
        is_crouching = true;
        is_creeping = false;
        hsp = 0;
        sprite_index = spr_player_down;
        image_speed = 0.3;
    }
    else if (key_down &amp;&amp; (key_left || key_right)) {
        // kúszás
        is_crouching = false;
        is_creeping = true;
        hsp = (key_right - key_left) * creep_speed;
        sprite_index = spr_player_creep;
        image_speed = 0.4;
    }
    else {
        is_crouching = false;
        is_creeping = false;
    }
}


//---------------------------------------------
//-------------platform------------------------
//---------------------------------------------


// --- PLATFORM ÁTESÉS ---
if (key_down &amp;&amp; key_jump) {
    can_fall_through = true;
    fall_through_timer = 10;  // 10 frame-ig átengedés
}

if (can_fall_through) {
    fall_through_timer -= 1;
    if (fall_through_timer &lt;= 0) can_fall_through = false;
}



// --- PLATFORM PASSABLE ÜTKÖZÉS ---
var plat = instance_place(x, y + vsp, obj_platform_passable);
if (plat != noone &amp;&amp; vsp &gt;= 0 &amp;&amp; !can_fall_through) {
    y = plat.y - sprite_height / 2;
    vsp = 0;
}

// ha felengedte a le nyilat → újra engedélyezett a slide és crouch
if (!key_down) {
    slide_released = true;
}

// ====================================================================
//                         NORMÁL MOZGÁS
// ====================================================================

if (!is_sliding &amp;&amp; !is_crouching &amp;&amp; !is_creeping) {
    hsp = (key_right - key_left) * walksp;
}

// ====================================================================
//                         UGRÁSOK
// ====================================================================

if (key_jump &amp;&amp; jump_count &lt; max_jumps &amp;&amp; !is_sliding &amp;&amp; !is_crouching &amp;&amp; !is_creeping) {
    vsp = jmp;
    jump_count += 1;

    if (jump_count == 1) {
        sprite_index = spr_player_jump;
        image_index = 0;
        image_speed = 0.5;
    } else if (jump_count == 2) {
        sprite_index = spr_player_doublejump;
        image_index = 0;
        image_speed = 0.5;
    }
}

// ====================================================================
//                        DOWN-JUMP (GYORSABB ZUHANÁS)
// ====================================================================

if (!on_ground &amp;&amp; vsp &gt; 0) {
    if (key_down &amp;&amp; !is_fastfall) {
        // egyszeri gyorsítás és animáció
        is_fastfall = true;
        vsp += grv * 8;
        hsp = 0;
        sprite_index = spr_player_downjump;
        image_index = 0;
        image_speed = 0.5;

        slide_released = false; // ne engedje rögtön slide/crouch földet érés után
    }
} 

// ====================================================================
//                           ANIMÁCIÓK
// ====================================================================

if (!is_sliding &amp;&amp; !is_creeping &amp;&amp; !is_crouching &amp;&amp; !is_fastfall) {
    // irány
    if (hsp &gt; 0) image_xscale = 1;
    if (hsp &lt; 0) image_xscale = -1;

    // landolás
    if (on_ground &amp;&amp; !was_on_ground) {
        sprite_index = spr_player_land;
        image_index = 0;
        image_speed = 1;
    }
    // levegőben
    else if (!on_ground &amp;&amp; sprite_index != spr_player_downjump) {
        if (jump_count == 1 &amp;&amp; sprite_index != spr_player_jump) {
            sprite_index = spr_player_jump;
            image_index = 0;
            image_speed = 0.5;
        } else if (jump_count == 2 &amp;&amp; sprite_index != spr_player_doublejump) {
            sprite_index = spr_player_doublejump;
            image_index = 0;
            image_speed = 0.5;
        }
    }
    // futás
    else if (hsp != 0 &amp;&amp; sprite_index != spr_player_land) {
        sprite_index = spr_player_run;
        image_speed = 1;
    }
    // állás
    else if (sprite_index != spr_player_land) {
        sprite_index = spr_player_idle;
        image_speed = 0.4;
    }
}

// land animáció vége → vissza idle-be
if (sprite_index == spr_player_land &amp;&amp; image_index &gt;= image_number - 1) {
    sprite_index = spr_player_idle;
    image_speed = 0.4;
}

// ====================================================================
//                           SEBZŐDÉS / HP
// ====================================================================




  var enemy3 = instance_place(x, y, obj_enemy3);
if (enemy3 != noone) {
 if (!invincible) {
        // --- NORMÁL ütközés ---  
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed;
        if (enemy3.x &gt; x) hsp = -35; else hsp = 35;
        vsp = -15;
    }
}

if (invincible) {
    invincible_timer -= 1;
    if (invincible_timer &lt;= 0) invincible = false;
}


 var enemy2 = instance_place(x, y, obj_enemy2);
if (enemy2 != noone) {
 if (!invincible) {
        // --- NORMÁL ütközés ---  
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed;
        if (enemy2.x &gt; x) hsp = -8; else hsp = 8;
        vsp = -6;
    }
}

if (invincible) {
    invincible_timer -= 1;
    if (invincible_timer &lt;= 0) invincible = false;
}












var enemy = instance_place(x, y, obj_enemy);
if (enemy != noone) {
    if (is_sliding) {
        // --- SLIDE ütközés ---  
     var push_dir;
    if (image_xscale == 1) {
        push_dir = 1;
    } else {
        push_dir = -1;
    }
    enemy.hsp = push_dir * 10;  // oldalirány
    enemy.vsp = -6;            // felfelé pattintás
    enemy.is_knocked = true;
    enemy.knock_timer = 20;  // 20 frame-ig „ütve” 
        
    // player nem sérül, nem lökődik
    }
    else if (is_fastfall) {
        // --- DOWNJUMP ütközés ---  
        enemy.hp -= 0.0001;            // enemy sebződik
         
        
        var push_dir;
        if (image_xscale == 1) {
            push_dir = 1;
        } else {
            push_dir = -1;
        }
        enemy.hsp = push_dir * 10;  // oldalirány
        enemy.vsp = -8;            // felfelé
  
        enemy.is_knocked = true;
        enemy.knock_timer = 20;  // 20 frame-ig „ütve”        
                      
                    // player nem sérül, nem lökődik
    }
    else if (!invincible) {
        // --- NORMÁL ütközés ---  
        p_hp -= 1;
        invincible = true;
        invincible_timer = room_speed;
        if (enemy.x &gt; x) hsp = -8; else hsp = 8;
        vsp = -6;
    }
}

if (invincible) {
    invincible_timer -= 1;
    if (invincible_timer &lt;= 0) invincible = false;
}

// ====================================================================
//                           PORHATÁS LANDOLÁSNÁL
// ====================================================================

// ha most ért földet
if (!was_on_ground &amp;&amp; on_ground) {
    var impact_speed = abs(vsp_previous); // előző frame-ből vesszük az esés sebességét
    if (impact_speed &gt; 4) { // csak ha tényleg gyorsan esett
        var dust = instance_create(x, y + sprite_height / 2, obj_dust);
        dust.image_xscale = image_xscale;
        dust.image_yscale = clamp(impact_speed / 10, 1, 2);
    }
}

// ====================================================================
//                            LÖVÉS
// ====================================================================

if (keyboard_check_pressed(vk_control) &amp;&amp; ammo &gt; 0 &amp;&amp; can_shoot) {
    var bullet = instance_create(x, y, obj_bullet);

    if (image_xscale == 1) bullet.direction = 0;
    else bullet.direction = 180;

    bullet.speed = 15;
    ammo -= 1;
    can_shoot = false;
    alarm[0] = shoot_cooldown;
}

// ====================================================================
//                      ÁLLAPOT MENTÉSE
// ====================================================================
vsp_previous = vsp;
was_on_ground = on_ground;
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
